# Тесты телеграм-бота для проверки заданий

## Структура тестов

```
tests/
├── __init__.py              # Инициализация пакета тестов
├── conftest.py              # Общие фикстуры pytest
├── unit/                    # Модульные тесты
│   ├── test_schemas.py      # Тесты Pydantic-схем
│   ├── test_utils.py        # Тесты вспомогательных функций
│   └── test_repositories.py # Тесты репозиториев
├── integration/             # Интеграционные тесты
│   └── test_homework_workflow.py  # Тесты рабочих процессов
└── functional/              # Функциональные тесты
    └── test_navigation.py   # Тесты навигации
```

## Типы тестов

### 1. Модульные тесты (Unit Tests)
Тестируют изолированные компоненты системы:
- Валидация данных через Pydantic
- Вспомогательные функции (разбиение сообщений и т.д.)
- Репозитории (CRUD операции с БД)

### 2. Интеграционные тесты (Integration Tests)
Тестируют взаимодействие нескольких компонентов:
- Создание заданий с привязкой к группам
- Автоматическое создание ответов для студентов
- Работа сервисов с репозиториями

### 3. Функциональные тесты (Functional Tests)
Тестируют сценарии работы пользователей:
- Навигация по меню бота
- Последовательность состояний FSM

## Запуск тестов

### Установка зависимостей
```bash
poetry install
```

### Запуск всех тестов
```bash
poetry run pytest
```

### Запуск конкретного типа тестов
```bash
# Только модульные
poetry run pytest tests/unit/

# Только интеграционные
poetry run pytest tests/integration/

# Только функциональные
poetry run pytest tests/functional/
```

### Запуск с покрытием кода
```bash
poetry run pytest --cov=src --cov-report=html
```

### Запуск конкретного файла тестов
```bash
poetry run pytest tests/unit/test_schemas.py -v
```

## Конфигурация

Основная конфигурация pytest находится в `conftest.py` и включает:
- Асинхронный event loop для pytest-asyncio
- Фикстуры для создания тестовой БД (SQLite in-memory)
- Фикстуры для создания тестовых сессий

## Требования

- Python 3.13+
- pytest >= 9.0.2
- pytest-asyncio
- SQLite (для in-memory тестовой БД)

## Примечания

- Тесты используют SQLite в памяти для изоляции от production БД
- Каждый тест получает чистую БД через фикстуру `db_session`
- Асинхронные тесты помечены декоратором `@pytest.mark.asyncio`
